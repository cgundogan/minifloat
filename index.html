<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Minifloat Comparison</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body style="height: 100vh; overflow-y: hidden">
    <p>$$ t_{seconds}(s,e,m,b) = \begin{cases}(-1)^s \times (0 + \frac{m}{m_{max}}) \times 2^{0+b+1} & \text{if} \ e = 0 \text{ (subnormal)}\\ (-1)^s \times (1 + \frac{m}{m_{max}}) \times 2^{e+b} & \text{if} \ e > 0 \text{ (normalized)}\end{cases} \qquad where \quad s:=sign \quad e:=exponent \quad m:=mantissa \quad b:=bias $$</p>
    <div id="myDiv" style="height:90%"></div>
    <script>
      function minifloat(x, sign, expbits, manbits, b) {
          var mans = (1 << manbits);
          var man = x & (mans - 1);
          var exp = (x & ((1 << expbits) - 1) << manbits) >> manbits;
          var res = 0;
          if (exp == 0) {
              res = (-1)**sign * (0 + man/mans) * 2**(b+1);
          }
          else {
              res = (-1)**sign * (1 + man/mans) * (2**(exp+b));
          }
          return res;
      }

      var range = [...Array(256).keys()];

      var c0530 = {
          x: range,
          y: range.map(a => {
              return minifloat(a,0,5,3,0);
          }),
          name: "(0,5,3,0)",
          type: 'scatter'
      };
      var c053m7 = {
          x: range,
          y: range.map(a => {
              return minifloat(a,0,5,3,-7);
          }),
          name: "(0,5,3,-7)",
          type: 'scatter'
      };
      var c053m6 = {
          x: range,
          y: range.map(a => {
              return minifloat(a,0,5,3,-6);
          }),
          name: "(0,5,3,-6)",
          type: 'scatter'
      };
      var c053m5 = {
          x: range,
          y: range.map(a => {
              return minifloat(a,0,5,3,-5);
          }),
          name: "(0,5,3,-5)",
          type: 'scatter'
      };
      var c0440 = {
          x: range,
          y: range.map(a => {
              return minifloat(a,0,4,4,0);
          }),
          name: "(0,4,4,0)",
          type: 'scatter'
      };
      var data = [c0530, c053m5, c053m6, c053m7, c0440];

      var updatemenus=[
          {
              buttons: [
                  {
                      args: ['yaxis.type', 'linear'],
                      label: 'Y-Linear',
                      method: 'relayout'
                  },
                  {
                      args: ['yaxis.type', 'log'],
                      label:'Y-Logarithmic',
                      method:'relayout'
                  }
              ],
              direction: 'left',
              pad: {'r': 10, 't': 10},
              showactive: true,
              type: 'buttons',
              x: 0.1,
              xanchor: 'left',
              y: 1.1,
              yanchor: 'top'
          }
      ]

      var layout = {
          title: '',
          font: {size: 18},
          autosize: true,
          updatemenus: updatemenus,
          xaxis: {
              type: 'linear',
              title: '8-bit time code',
              autorange: true,
              exponentformat: 'none',
              automargin: true,
          },
          yaxis: {
              type: 'log',
              title: 'time value',
              autorange: true,
              exponentformat: 'none',
              automargin: true,
          },
      };

      Plotly.newPlot('myDiv', data, layout, {responsive: true});
    </script>
  </body>
</html>
